!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Waver=e():t.Waver=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};return e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t){return"destination"===t?AudioDestinationNode:"stream"===t?MediaStreamAudioDestinationNode:null}function i(t){return"buffer"===t?AudioBufferSourceNode:"constant"===t?ConstantSourceNode:"media"===t?MediaElementAudioSourceNode:"stream"===t?MediaStreamAudioSourceNode:null}function u(t,e){var r=f(e,2),n=r[0],o=r[1];if("biquadFilter"===n){var a=t.createBiquadFilter();return null!==o&&(a.type=o),a}if("delay"===n)return t.createDelay(o);if("compressor"===n)return t.createDynamicsCompressor();if("gain"===n){var i=t.createGain();return null!==o&&(i.gain.value=o),i}if("oscillator"===n){var u=t.createOscillator();return null!==o&&(u.type=o),u}if("pan"===n){var s=t.createStereoPanner();return null!==o&&(s.pan.value=o),s}return null}function s(){return new d}function c(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return new(Function.prototype.bind.apply(v,[null].concat(e)))}Object.defineProperty(e,"__esModule",{value:!0}),e.parser=void 0;var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),f=function(){function t(t,e){var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=t[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{!n&&u.return&&u.return()}finally{if(o)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.createAudioContext=s,e.createWaver=c;var h=r(1),y=function(t){return t&&t.__esModule?t:{default:t}}(h);e.parser=y.default;var d=window.AudioContext||window.webkitAudioContext,v=function(){function t(e,r){if(o(this,t),!(e instanceof d))throw new Error("`context` is not type of AudioContext!");if("string"!=typeof r)throw new Error("`source` is not type of String!");var n=y.default.parse(r);this._context=e,this._outputTypes=new Map,this._inputTypes=new Map,this._paramTypes=new Map,this._output=new Map,this._input=new Map,this._node=new Map,this._param=new Map,this._chain=[],this._setup=[],this._enabled=!1,this._request=0;for(var s in n.outputTypes){var c=n.outputTypes[s],l=a(c);if(!l)throw new Error("Unsupported output type: "+c);this._outputTypes.set(s,l),this._output.set(s,null)}for(var p in n.inputTypes){var h=n.inputTypes[p],v=i(h);if(!v)throw new Error("Unsupported input type: "+h);this._inputTypes.set(p,v),this._input.set(p,null)}for(var $ in n.nodeTypes){var g=n.nodeTypes[$],_=u(e,g);if(!_)throw new Error("Unsupported node type: "+g);this._node.set($,_)}for(var m in n.paramTypes){var w=f(n.paramTypes[m],2),b=w[0],k=w[1];if("float"!==b)throw new Error("Unsupported param type: "+b);this._paramTypes.set(m,"number"),this._param.set(m,k||0)}var x=!0,E=!1,A=void 0;try{for(var T,S=n.chains[Symbol.iterator]();!(x=(T=S.next()).done);x=!0)for(var F=T.value,M=0,C=F.length-1;M<C;++M)this._chain.push({from:F[M],to:F[M+1]})}catch(t){E=!0,A=t}finally{try{!x&&S.return&&S.return()}finally{if(E)throw A}}var N=!0,W=!1,O=void 0;try{for(var j,D=n.setup[Symbol.iterator]();!(N=(j=D.next()).done);N=!0){var P=j.value;this._setup.push({node:P[0],param:P[1],value:P[2]})}}catch(t){W=!0,O=t}finally{try{!N&&D.return&&D.return()}finally{if(W)throw O}}this._valid=!0}return p(t,[{key:"valid",get:function(){return!!this._valid}},{key:"outputs",get:function(){return[].concat(n(this._output.keys()))}},{key:"inputs",get:function(){return[].concat(n(this._input.keys()))}},{key:"params",get:function(){return[].concat(n(this._param.keys()))}},{key:"nodes",get:function(){return[].concat(n(this._node.keys()))}},{key:"enabled",get:function(){return this._enabled},set:function(t){if("boolean"!=typeof t)throw new Error("`value` is not type of Boolean!");if(!this._valid)throw new Error("Waver is not valid!");this._enabled=t,cancelAnimationFrame(this._request),t&&this._process()}}]),p(t,[{key:"dispose",value:function(){this.enabled=!1,this._valid&&this._disconnect(),this._context=null,this._outputTypes=null,this._inputTypes=null,this._paramTypes=null,this._output=null,this._input=null,this._node=null,this._param=null,this._chain=null,this._setup=null,this._valid=!1}},{key:"bindOutput",value:function(t,e){if(!this._valid)throw new Error("Waver is not valid!");if("string"!=typeof t)throw new Error("`value` is not type of String!");var r=this._outputTypes;if(!r.has(t))throw new Error("Waver does not have output named: "+t);if(e&&!(e instanceof r.get(t)))throw new Error("`value` is not type of "+r.get(t).constructor.name+"!");this._disconnect(),this._output.set(t,e),this._connect()}},{key:"bindInput",value:function(t,e){if(!this._valid)throw new Error("Waver is not valid!");if("string"!=typeof t)throw new Error("`value` is not type of String!");var r=this._inputTypes;if(!r.has(t))throw new Error("Waver does not have input named: "+t);if(e&&!(e instanceof r.get(t)))throw new Error("`value` is not type of "+r.get(t).prototype.constructor.name+"!");this._disconnect(),this._input.set(t,e),this._connect()}},{key:"setParam",value:function(t,e){if(!this._valid)throw new Error("Waver is not valid!");if("string"!=typeof t)throw new Error("`value` is not type of String!");var r=this._paramTypes;if(!r.has(t))throw new Error("Waver does not have param named: "+t);if((void 0===e?"undefined":l(e))!==r.get(t))throw new Error("`value` is not type of "+r.get(t)+"!");this._param.set(t,e)}},{key:"_process",value:function(){var t=this;if(!this._valid)throw new Error("Waver is not valid!");var e=this._setup,r=(this._param,!0),n=!1,o=void 0;try{for(var a,i=e[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var u=a.value,s=u.node,c=u.param,l=u.value,p=this._findNode(s);if(p&&c in p){var f=this._getValue(l);"value"in p[c]?p[c].value=f:p[c]=f}}}catch(t){n=!0,o=t}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}this._request=requestAnimationFrame(function(){return t._process()})}},{key:"_findNode",value:function(t){var e=this._output,r=this._input,n=this._node;return e.has(t)?e.get(t):r.has(t)?r.get(t):n.has(t)?n.get(t):null}},{key:"_getValue",value:function(t){var e=this._param;if("string"==typeof t){if(!e.has(t))throw new Error("Waver does not have param: "+t);return e.get(t)}if(t instanceof Function){var r={},n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var s=f(i.value,2),c=s[0],l=s[1];r[c]=l}}catch(t){o=!0,a=t}finally{try{!n&&u.return&&u.return()}finally{if(o)throw a}}return t.call(r)}return t}},{key:"_connect",value:function(){var t=this._chain,e=!0,r=!1,n=void 0;try{for(var o,a=t[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value,u=this._findNode(i.from),s=this._findNode(i.to);u&&s&&u.connect(s)}}catch(t){r=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw n}}}},{key:"_disconnect",value:function(){var t=this._chain,e=!0,r=!1,n=void 0;try{for(var o,a=t[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value,u=this._findNode(i.from),s=this._findNode(i.to);if(u&&s)try{u.disconnect(s)}catch(t){}}}catch(t){r=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw n}}}}]),t}();e.default=v},function(t,e,r){"use strict";t.exports=function(){function t(e,r,n,o){this.message=e,this.expected=r,this.found=n,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}function e(e,r){function n(){return e.substring(b,w)}function o(t,e){return{type:"literal",text:t,ignoreCase:e}}function a(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function i(t){return{type:"other",description:t}}function u(t){var r,n=k[t];if(n)return n;for(r=t-1;!k[r];)r--;for(n=k[r],n={line:n.line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return k[t]=n,n}function s(t,e){var r=u(t),n=u(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function c(t){w<x||(w>x&&(x=w,E=[]),E.push(t))}function l(e,r,n){return new t(t.buildMessage(e,r),e,r,n)}function p(t){var e,r=new Array(t.length);for(e=0;e<t.length;e++)r[e]=t.charCodeAt(e)-32;return r}function f(t){for(var r,n,o=m[t],a=0,i=[],u=o.length,s=[],l=[];;){for(;a<u;)switch(o[a]){case 0:l.push(_[o[a+1]]),a+=2;break;case 1:l.push(void 0),a++;break;case 2:l.push(null),a++;break;case 3:l.push(v),a++;break;case 4:l.push([]),a++;break;case 5:l.push(w),a++;break;case 6:l.pop(),a++;break;case 7:w=l.pop(),a++;break;case 8:l.length-=o[a+1],a+=2;break;case 9:l.splice(-2,1),a++;break;case 10:l[l.length-2].push(l.pop()),a++;break;case 11:l.push(l.splice(l.length-o[a+1],o[a+1])),a+=2;break;case 12:l.push(e.substring(l.pop(),w)),a++;break;case 13:s.push(u),i.push(a+3+o[a+1]+o[a+2]),l[l.length-1]?(u=a+3+o[a+1],a+=3):(u=a+3+o[a+1]+o[a+2],a+=3+o[a+1]);break;case 14:s.push(u),i.push(a+3+o[a+1]+o[a+2]),l[l.length-1]===v?(u=a+3+o[a+1],a+=3):(u=a+3+o[a+1]+o[a+2],a+=3+o[a+1]);break;case 15:s.push(u),i.push(a+3+o[a+1]+o[a+2]),l[l.length-1]!==v?(u=a+3+o[a+1],a+=3):(u=a+3+o[a+1]+o[a+2],a+=3+o[a+1]);break;case 16:l[l.length-1]!==v?(s.push(u),i.push(a),u=a+2+o[a+1],a+=2):a+=2+o[a+1];break;case 17:s.push(u),i.push(a+3+o[a+1]+o[a+2]),e.length>w?(u=a+3+o[a+1],a+=3):(u=a+3+o[a+1]+o[a+2],a+=3+o[a+1]);break;case 18:s.push(u),i.push(a+4+o[a+2]+o[a+3]),e.substr(w,_[o[a+1]].length)===_[o[a+1]]?(u=a+4+o[a+2],a+=4):(u=a+4+o[a+2]+o[a+3],a+=4+o[a+2]);break;case 19:s.push(u),i.push(a+4+o[a+2]+o[a+3]),e.substr(w,_[o[a+1]].length).toLowerCase()===_[o[a+1]]?(u=a+4+o[a+2],a+=4):(u=a+4+o[a+2]+o[a+3],a+=4+o[a+2]);break;case 20:s.push(u),i.push(a+4+o[a+2]+o[a+3]),_[o[a+1]].test(e.charAt(w))?(u=a+4+o[a+2],a+=4):(u=a+4+o[a+2]+o[a+3],a+=4+o[a+2]);break;case 21:l.push(e.substr(w,o[a+1])),w+=o[a+1],a+=2;break;case 22:l.push(_[o[a+1]]),w+=_[o[a+1]].length,a+=2;break;case 23:l.push(v),0===A&&c(_[o[a+1]]),a+=2;break;case 24:b=l[l.length-1-o[a+1]],a+=2;break;case 25:b=w,a++;break;case 26:for(r=o.slice(a+4,a+4+o[a+3]),n=0;n<o[a+3];n++)r[n]=l[l.length-1-r[n]];l.splice(l.length-o[a+2],o[a+2],_[o[a+1]].apply(null,r)),a+=4+o[a+3];break;case 27:l.push(f(o[a+1])),a+=2;break;case 28:A++,a++;break;case 29:A--,a++;break;default:throw new Error("Invalid opcode: "+o[a]+".")}if(!(s.length>0))break;u=s.pop(),a=i.pop()}return l[0]}function h(t,e){var r=[t];return e.map(function(t){return r.push(t[3])}),r}function y(t){return new Function("return "+t+";")}r=void 0!==r?r:{};var d,v={},$={Program:0},g=0,_=[function(){return{outputTypes:T,inputTypes:S,nodeTypes:F,paramTypes:M,chains:C,setup:N}},function(t,e){C.push(h(t,e))},".",o(".",!1),"=",o("=",!1),function(t,e,r){N.push([t,e,r])},i("output"),function(t,e){T[e]=t},i("input"),function(t,e){S[e]=t},i("node"),"(",o("(",!1),")",o(")",!1),function(t,e,r){F[e]=[t,r&&r[3]]},i("param"),function(t,e,r){M[e]=[t,r&&r[3]]},"output",o("output",!1),"input",o("input",!1),"node",o("node",!1),"param",o("param",!1),i("value"),i("identifier"),/^[_a-zA-Z]/,a(["_",["a","z"],["A","Z"]],!1,!1),/^[_a-zA-Z0-9]/,a(["_",["a","z"],["A","Z"],["0","9"]],!1,!1),function(){return n()},i("float"),"-",o("-",!1),/^[0-9]/,a([["0","9"]],!1,!1),function(){return parseFloat(n())},i("lambda"),"{",o("{",!1),"}",o("}",!1),function(t){return y(t.trim())},/^[^"}"]/,a(['"',"}",'"'],!0,!1),i("connect"),"=>",o("=>",!1),i("semicolon"),";",o(";",!1),i("whitespace"),/^[ \t\n\r]/,a([" ","\t","\n","\r"],!1,!1),i("whitespace_any")],m=[p("%$;!0#*;!&/& 8!: ! )"),p("%;6/G#;%./ &;\".) &;#.# &;$/,$;6/#$+#)(#'#(\"'#&'#"),p("%;//#$%;6/>#;3/5$;6/,$;//#$+$)($'#(#'#(\"'#&'#/K#0H*%;6/>#;3/5$;6/,$;//#$+$)($'#(#'#(\"'#&'#&&&#/;$;6/2$;4/)$8$:!$\"#\")($'#(#'#(\"'#&'#"),p("%;//#;6/$2\"\"\"6\"7#/x$;6/o$;//f$;6/]$2$\"\"6$7%/N$;6/E$;./<$;6/3$;4/*$8+:&+#*&\")(+'#(*'#()'#(('#(''#(&'#(%'#($'#(#'#(\"'#&'#"),p("%;//f#;6/]$2\"\"\"6\"7#/N$;6/E$;//<$;6/3$;1/*$8':&'#&\" )(''#(&'#(%'#($'#(#'#(\"'#&'#"),p("%;&./ &;'.) &;(.# &;)/5#;6/,$;4/#$+#)(#'#(\"'#&'#"),p("<%;*/M#;5/D$;//;$;5/2$;//)$8%:(%\"\" )(%'#($'#(#'#(\"'#&'#=.\" 7'"),p("<%;+/M#;5/D$;//;$;5/2$;//)$8%:*%\"\" )(%'#($'#(#'#(\"'#&'#=.\" 7)"),p("<%;,/#;5/$;//$;5/$;//{$%;6/\\#2,\"\"6,7-/M$;6/D$;./;$;6/2$2.\"\"6.7//#$+&)(&'#(%'#($'#(#'#(\"'#&'#.\" &\"/*$8&:0&##! )(&'#(%'#($'#(#'#(\"'#&'#=.\" 7+"),p("<%;-/#;5/$;//$;5/$;//{$%;6/\\#2,\"\"6,7-/M$;6/D$;./;$;6/2$2.\"\"6.7//#$+&)(&'#(%'#($'#(#'#(\"'#&'#.\" &\"/*$8&:2&##! )(&'#(%'#($'#(#'#(\"'#&'#=.\" 71"),p('23""6374'),p('25""6576'),p('27""6778'),p('29""697:'),p('<;0.# &;/=." 7;'),p('<%;6/R#4=""5!7>/C$$4?""5!7@0)*4?""5!7@&/\'$8#:A# )(#\'#("\'#&\'#=." 7<'),p('<%;6/#2C""6C7D." &"/$$4E""5!7F/,#0)*4E""5!7F&&&#/g$%2"""6"7#/E#$4E""5!7F/,#0)*4E""5!7F&&&#/#$+")("\'#&\'#." &"/\'$8$:G$ )($\'#(#\'#("\'#&\'#=." 7B'),p('<%;6/O#2I""6I7J/@$;2/7$2K""6K7L/($8$:M$!!)($\'#(#\'#("\'#&\'#=." 7H'),p('%$4N""5!7O0)*4N""5!7O&/& 8!:A! )'),p('<%;6/;#2Q""6Q7R/,$;6/#$+#)(#\'#("\'#&\'#=." 7P'),p('<%;6/k#$%2T""6T7U/,#;6/#$+")("\'#&\'#/?#0<*%2T""6T7U/,#;6/#$+")("\'#&\'#&&&#/#$+")("\'#&\'#=." 7S'),p('<$4W""5!7X/,#0)*4W""5!7X&&&#=." 7V'),p('<$4W""5!7X0)*4W""5!7X&=." 7Y')],w=0,b=0,k=[{line:1,column:1}],x=0,E=[],A=0;if("startRule"in r){if(!(r.startRule in $))throw new Error("Can't start parsing from rule \""+r.startRule+'".');g=$[r.startRule]}var T={},S={},F={},M={},C=[],N=[];if((d=f(g))!==v&&w===e.length)return d;throw d!==v&&w<e.length&&c(function(){return{type:"end"}}()),l(E,x<e.length?e.charAt(x):null,x<e.length?s(x,x+1):s(x,x))}return function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(t,Error),t.buildMessage=function(t,e){function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+r(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+r(t)})}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+r(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+r(t)})}function a(t){return i[t.type](t)}var i={literal:function(t){return'"'+n(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?o(t.parts[e][0])+"-"+o(t.parts[e][1]):o(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};return"Expected "+function(t){var e,r,n=new Array(t.length);for(e=0;e<t.length;e++)n[e]=a(t[e]);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+function(t){return t?'"'+n(t)+'"':"end of input"}(e)+" found."},{SyntaxError:t,parse:e}}()},function(t,e,r){t.exports=r(0)}])});
//# sourceMappingURL=waver.js.map